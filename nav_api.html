<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation API Tester</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; background: #f4f4f9; }
        .card { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }
        h2 { margin-top: 0; color: #333; }
        button { cursor: pointer; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 4px; font-size: 14px; margin-right: 5px; margin-bottom: 5px; }
        button:hover { background: #0056b3; }
        button.secondary { background: #6c757d; }
        button.secondary:hover { background: #5a6268; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        
        ul { list-style: none; padding: 0; }
        li { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        li:last-child { border-bottom: none; }
        .current-entry { background-color: #e7f1ff; font-weight: bold; border-left: 4px solid #007bff; }
        .url-text { font-family: monospace; color: #d63384; }
        .meta { font-size: 0.85em; color: #666; }
        #status { padding: 10px; background: #e2e3e5; border-radius: 4px; font-family: monospace; margin-bottom: 1rem; }
    </style>
</head>
<body>

    <h1>Navigation API Inspector</h1>
    
    <div id="status">Checking support...</div>

    <div class="card">
        <h2>1. Create History</h2>
        <p>Click these to push new entries to the Navigation stack (SPA navigation):</p>
        <button onclick="doNavigate('/home')">Go to /home</button>
        <button onclick="doNavigate('/nav_api2.html?gclid=2799')">Go to /nav_api2.html</button>
        <button onclick="doNavigate('/nav_api3.html?gclid=3799')">Go to /nav_api3.html</button>
        <a href="/nav_api2.html?gclid=27998"> Go to /nav_api2.html </a>
        <a href="/nav_api3.html?gclid=37998"> Go to /nav_api3.html </a>
        <button onclick="doNavigate('/contact?id=123')">Go to /contact?id=123</button>
    </div>

    <div class="card">
        <h2>2. Traverse History</h2>
        <button class="secondary" onclick="navigation.back()">⬅ Back</button>
        <button class="secondary" onclick="navigation.forward()">Forward ➡</button>
        <button class="secondary" onclick="navigation.reload()">Reload ↻</button>
    </div>

    <div class="card">
        <h2>3. History Stack (`navigation.entries()`)</h2>
        <p>Below is the list of all accessible history entries for this session:</p>
        <ul id="historyList">
            </ul>
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const listEl = document.getElementById('historyList');

        // 1. Check Support
        if (!('navigation' in window)) {
            statusEl.textContent = "❌ Navigation API not supported in this browser.";
            statusEl.style.background = "#f8d7da";
            document.querySelectorAll('button').forEach(b => b.disabled = true);
        } else {
            statusEl.textContent = "✅ Navigation API is active.";
            statusEl.style.background = "#d1e7dd";
            renderHistory();
        }

        // 2. Intercept Navigations (SPA Behavior)
        // This prevents the browser from actually trying to load 'file:///settings' etc.
        if (window.navigation) {
            navigation.addEventListener('navigate', (event) => {
                const url = new URL(event.destination.url);
                
                // Only intercept local navigations
                if (location.origin !== url.origin) return;

                event.intercept({
                    handler: async () => {
                        console.log(`Mapsd to ${url.pathname}`);
                        // In a real app, you would fetch content or render a view here
                    }
                });
            });

            // 3. Listen for changes to update UI
            navigation.addEventListener('currententrychange', () => {
                renderHistory();
            });
        }

        // Helper to trigger navigation
        function doNavigate(path) {
            // navigation.navigate returns a result object with { committed, finished } promises
            navigation.navigate(path);
        }

        // 4. Core Logic: List Entries
        function renderHistory() {
            if (!window.navigation) return;

            const entries = navigation.entries(); // Returns array of NavigationHistoryEntry
            const currentEntry = navigation.currentEntry;

            listEl.innerHTML = '';

            entries.forEach((entry, index) => {
                const li = document.createElement('li');
                
                // Highlight the current active page
                if (entry.id === currentEntry.id) {
                    li.classList.add('current-entry');
                }

                // Extract relative path for cleaner display
                let displayUrl;
                try {
                    const u = new URL(entry.url);
                    displayUrl = u.pathname + u.search;
                } catch(e) {
                    displayUrl = entry.url; // Fallback for about:blank or initial
                }

                li.innerHTML = `
                    <div>
                        <span class="meta">[Index: ${entry.index}]</span>
                        <span class="url-text">${displayUrl || '(initial)'}</span>
                    </div>
                    <div class="meta">
                        ID: ${entry.id.substring(0, 8)}...
                        ${entry.id === currentEntry.id ? ' <b>(Current)</b>' : ''}
                    </div>
                `;

                // Optional: Click list item to traverse to that specific entry
                // navigation.traverseTo(entry.key);
                
                listEl.appendChild(li);
            });
        }
    </script>
</body>
</html>
